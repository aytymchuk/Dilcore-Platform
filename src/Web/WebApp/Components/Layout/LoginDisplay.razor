@using Microsoft.AspNetCore.Components.Authorization
@using System.Security.Claims
@using Dilcore.WebApp.Constants

<AuthorizeView>
    <Authorized>
        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="4">
            <MudText>Hello, @context.User.Identity?.Name!</MudText>
            @if (context.User.HasClaim(c => c.Type == AuthConstants.AccessTokenClaim))
            {
                <MudTooltip Text="Access Token">
                    <MudIconButton Icon="@Icons.Material.Filled.Key" OnClick="@(() => _showToken = !_showToken)" Color="Color.Inherit" />
                </MudTooltip>
            }
            <MudLink Href="@RouteConstants.Identity.Logout" Color="Color.Inherit">Sign Out</MudLink>
        </MudStack>
        
        @if (_showToken)
        {
            <MudPopover Open="@_showToken" AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight" Class="pa-4" Style="max-width: 500px; word-break: break-all;">
                <MudText Typo="Typo.h6">Access Token</MudText>
                <MudDivider Class="my-2" />
                <MudText Typo="Typo.body2">@context.User.FindFirst(AuthConstants.AccessTokenClaim)?.Value</MudText>
            </MudPopover>
        }
    </Authorized>
    <NotAuthorized>
        <MudLink Href="@RouteConstants.Identity.Login" Color="Color.Inherit">Sign In</MudLink>
    </NotAuthorized>
</AuthorizeView>

@code {
    private bool _showToken;
}
